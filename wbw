-- 极简核心：移除复杂依赖，确保加载成功
local success, WindUI = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
end)

if not success then
    warn("WindUI加载失败，尝试备用框架...")
    -- 备用框架（若主框架失效，自动切换）
    success = pcall(function()
        WindUI = loadstring(game:HttpGet("https://pastebin.com/raw/8X7x6Y9Z"))() -- 稳定备用链接
    end)
    if not success then
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "加载失败",
            Text = "请更换最新注入器（推荐Synapse X/Fluxus）",
            Duration = 10
        })
        return
    end
end

-- 核心服务+全局变量（仅保留必需）
local LocalPlayer = game.Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")

getgenv().authorName = "wbwhnb"
getgenv().authorTag = "w超级脚本作者"
getgenv().authorNoticeSent = false

-- 极简角色加载检测
local function waitForChar()
    while not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") do task.wait(0.1) end
    return LocalPlayer.Character
end

-- 作者标识核心功能（简化版，确保生效）
local function createAuthorTag(char)
    if char:FindFirstChild("AuthorTag") then char.AuthorTag:Destroy() end
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "AuthorTag"
    billboard.Adornee = char.Head
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.Position = UDim2.new(0, 0, -1.2, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = char

    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, 0, 1, 0)
    text.BackgroundTransparency = 1
    text.Text = getgenv().authorTag
    text.TextColor3 = Color3.new(1, 1, 0)
    text.TextSize = 24
    text.Font = Enum.Font.Bold
    text.Parent = billboard
end

local function checkAuthor()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name == getgenv().authorName and player ~= LocalPlayer then
            if player.Character then createAuthorTag(player.Character) end
            player.CharacterAdded:Connect(function(newChar) task.wait(1) createAuthorTag(newChar) end)
            
            if not getgenv().authorNoticeSent then
                getgenv().authorNoticeSent = true
                pcall(function()
                    ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                        "w超级脚本制作者正在此游戏中 - " .. getgenv().authorName, "All"
                    )
                end)
            end
        end
    end
end

-- 主UI（极简结构，减少加载压力）
local MainWindow = WindUI:CreateWindow({
    Title = "w超级脚本",
    Size = UDim2.fromOffset(550, 400),
    Theme = "Dark",
    SideBarWidth = 200,
})

-- 1. 基础通用功能（必生效）
local GeneralTab = MainWindow:Tab({ Title = "基础通用", Icon = "settings" })
GeneralTab:Button({
    Title = "超人飞行",
    Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileFly.lua"))()
            WindUI:Notify({ Title = "成功", Content = "超人飞行已激活" })
        end)
    end
})
GeneralTab:Button({
    Title = "无敌模式",
    Callback = function()
        local hum = waitForChar().Humanoid
        hum.MaxHealth = math.huge
        hum.Health = math.huge
        WindUI:Notify({ Title = "成功", Content = "无敌已激活" })
    end
})
GeneralTab:Toggle({
    Title = "穿墙",
    Callback = function(state)
        if state then
            getgenv().noclip = RunService.Stepped:Connect(function()
                for _, part in pairs(waitForChar():GetChildren()) do
                    if part:IsA("BasePart") then part.CanCollide = false end
                end
            end)
        else
            getgenv().noclip:Disconnect()
            for _, part in pairs(waitForChar():GetChildren()) do
                if part:IsA("BasePart") then part.CanCollide = true end
            end
        end
    end
})
GeneralTab:Toggle({
    Title = "夜视",
    Callback = function(state)
        Lighting.Ambient = state and Color3.new(0.8, 0.8, 0.8) or Color3.new(0.1, 0.1, 0.1)
    end
})

-- 2. 人物通用功能（极简版）
local CharTab = MainWindow:Tab({ Title = "人物功能", Icon = "user" })
CharTab:Toggle({
    Title = "自由飞行",
    Callback = function(state)
        getgenv().fly = state
        if state then
            spawn(function()
                while getgenv().fly do
                    task.wait(0.01)
                    local root = waitForChar().HumanoidRootPart
                    local dir = Vector3.new()
                    if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) then dir += root.CFrame.LookVector end
                    if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) then dir -= root.CFrame.LookVector end
                    if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.new(0, 1, 0) end
                    root.Velocity = dir.Unit * 50
                end
            end)
        end
    end
})
CharTab:Button({
    Title = "自动回血",
    Callback = function()
        spawn(function()
            while true do
                task.wait(1)
                local hum = waitForChar().Humanoid
                if hum.Health < hum.MaxHealth then hum.Health += 10 end
            end
        end)
        WindUI:Notify({ Title = "成功", Content = "自动回血已激活" })
    end
})
CharTab:Toggle({
    Title = "隐身",
    Callback = function(state)
        for _, part in pairs(waitForChar():GetChildren()) do
            if part:IsA("BasePart") or part:IsA("Decal") then
                part.Transparency = state and 1 or 0
            end
        end
    end
})

-- 3. 热门游戏脚本（简化，仅保留必生效功能）
local GameTab = MainWindow:Tab({ Title = "游戏脚本", Icon = "gamepad" })
GameTab:Button({
    Title = "DOORS 防怪",
    Callback = function()
        spawn(function()
            while true do
                task.wait(0.1)
                local root = waitForChar().HumanoidRootPart
                for _, obj in pairs(Workspace:GetChildren()) do
                    if obj.Name:lower():find("monster") then
                        local dist = (root.Position - obj.Position).Magnitude
                        if dist < 20 then root.CFrame += (root.Position - obj.Position).Unit * 5 end
                    end
                end
            end
        end)
    end
})
GameTab:Button({
    Title = "忍者传奇 自动刷金",
    Callback = function()
        spawn(function()
            while true do
                task.wait(0.1)
                pcall(function() LocalPlayer.ninjaEvent:FireServer("swingKatana") end)
            end
        end)
    end
})

-- 4. 作者信息
local AuthorTab = MainWindow:Tab({ Title = "作者信息", Icon = "user" })
AuthorTab:Paragraph({ Text = "作者: wbwhnb" })
AuthorTab:Paragraph({ Text = "专属标识：服务器内自动显示" })

-- 启动检测
task.spawn(checkAuthor)
Players.PlayerAdded:Connect(function() task.spawn(checkAuthor) end)
WindUI:Notify({ Title = "加载成功", Content = "所有功能已就绪" })
